# Pull request against these branches will trigger this build
#pr:
#- staging
#- master

# Any commit to these branches will trigger the build.
#trigger:
#- staging
#- master

pool:
  name: ForecastingBP
  vmImage: 'forecastingtestmachine'

steps:

- bash: |
    echo "##vso[task.prependpath]/data/anaconda/bin"
  displayName: Add conda to PATH

- bash: |
    . /anaconda/etc/profile.d/conda.sh && \
    conda activate forecasting_base && \
    Rscript tests/unit/source_entire.R -m "not notebooks and not spark and not gpu" --junitxml=reports/test-unit.xml && \
    conda deactivate
  displayName: 'Run R unit tests'

- task: PublishTestResults@2
  inputs:
    testResultsFiles: '**/test-unitttest.xml'
    testRunTitle: 'Test results for R Unit Tests'